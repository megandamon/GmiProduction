[Workflow Architecture]
NAME = GMI
VERSION = 1.0.0
CREATOR =
CREATION_DATE = 
DESCRIPTION =
LOGGING_DIRECTORY = log
OVERALL_STATUS = QUEUED


###############################################################################
#
# Prepare the environment for running GMI
#
###############################################################################

[Task.Prepare Environment]
NAME = Prepare Environment
TASK_TYPE = PARENT

[Task.Prepare Environment.Set Up Workflow Environment]
NAME = Setup Workflow Environment
DESCRIPTION = 
TASK_TYPE = SYSTEM
EXECUTABLE_OBJECT = $NED_WORKING_DIR/GMI/bin/setup_wf_env.bash 
TASK_DEPENDENCY = 

[Task.Prepare Environment.Check SSH Keys]
NAME = Check SSH Keys
DESCRIPTION = 
TASK_TYPE = SYSTEM
EXECUTABLE_OBJECT = $NED_WORKING_DIR/$NED_UNIQUE_ID/bin/check_ssh_keys.bash 
TASK_DEPENDENCY = Set Up Workflow Environment eq Completed

[Task.Prepare Environment.Set Up GMI Environment]
NAME = Set Up GMI Environment
DESCRIPTION = 
TASK_TYPE = SYSTEM
EXECUTABLE_OBJECT = $NED_WORKING_DIR/$NED_UNIQUE_ID/bin/setup_gmi_env.bash 
TASK_DEPENDENCY = Check SSH Keys eq Completed

[Task.Prepare Environment.Compile GMI]
NAME = Compile GMI
DESCRIPTION = 
TASK_TYPE = SYSTEM
EXECUTABLE_OBJECT =$NED_WORKING_DIR/$NED_UNIQUE_ID/bin/compile_gmi.bash 
TASK_DEPENDENCY = Set Up GMI Environment eq Completed

[Task.Prepare Environment.Prepare Installation]
NAME = Prepare Installation
DESCRIPTION = 
TASK_TYPE = SYSTEM
EXECUTABLE_OBJECT = $NED_WORKING_DIR/$NED_UNIQUE_ID/bin/prepare_installation.bash 
TASK_DEPENDENCY = Compile GMI eq Completed

[Task.Prepare Environment.Set Up Input Files]
NAME = Set Up Input Files
DESCRIPTION = 
TASK_TYPE = SYSTEM
EXECUTABLE_OBJECT = $NED_WORKING_DIR/$NED_UNIQUE_ID/bin/setup_input_files.bash 
TASK_DEPENDENCY = Prepare Installation eq Completed

[Task.Prepare Environment.Regrid Files]
NAME = Regrid Files
DESCRIPTION = 
TASK_TYPE = SYSTEM
EXECUTABLE_OBJECT = ls -alF $NED_WORKING_DIR
TASK_DEPENDENCY = Set Up Input Files eq Completed




#------------------------------------------------------------------------------
# Create input files and scripts, and submit jobs
#------------------------------------------------------------------------------
[Task.Run Yearly Jobs]
NAME = Run Yearly Jobs
DESCRIPTION = Outer loop to handle multi-year production runs
TASK_TYPE = LOOP
ITERATION_LIMIT = GMI Test Workflow.Workflow Properties.Date and Time.NUM_YEARS



[Task.Run Yearly Jobs.Submit Monthly Jobs]
NAME = Submit Monthly Jobs
DESCRIPTION = Prepares input files and submits monthly jobs
TASK_TYPE = LOOP
ITERATION_LIMIT = GMI Test Workflow.Workflow Properties.Date and Time.NUM_SUBMITS

[Task.Run Yearly Jobs.Submit Monthly Jobs.Modify Namelist]
NAME = Modify Namelist
DESCRIPTION = 
TASK_TYPE = SYSTEM
EXECUTABLE_OBJECT = $NED_WORKING_DIR/$NED_UNIQUE_ID/bin/modify_namelist.bash 
TASK_DEPENDENCY = Regrid Files eq Completed

[Task.Run Yearly Jobs.Submit Monthly Jobs.Modify Metfields]
NAME = Modify Metfields
DESCRIPTION = 
TASK_TYPE = SYSTEM
EXECUTABLE_OBJECT = $NED_WORKING_DIR/$NED_UNIQUE_ID/bin/modify_metfields.bash 
TASK_DEPENDENCY = Modify Namelist eq Completed

[Task.Run Yearly Jobs.Submit Monthly Jobs.Create PBS Script]
NAME = Create PBS Script
DESCRIPTION = 
TASK_TYPE = SYSTEM
EXECUTABLE_OBJECT = $NED_WORKING_DIR/$NED_UNIQUE_ID/bin/create_pbs_script.bash 
TASK_DEPENDENCY = Modify Metfields eq Completed

[Task.Run Yearly Jobs.Reset Date]
NAME = Reset Date 
DESCRIPTION = 
TASK_TYPE = SYSTEM
EXECUTABLE_OBJECT = . $NED_WORKING_DIR/.exp_env.bash; echo "#Resetting date for monitoring" >> $NED_WORKING_DIR/.exp_env.bash;echo "export CURRENT_DATE=" >> $NED_WORKING_DIR/.exp_env.bash
TASK_DEPENDENCY = Submit Monthly Jobs eq Completed

#------------------------------------------------------------------------------
# Monitor Jobs
#------------------------------------------------------------------------------
[Task.Run Yearly Jobs.Monitor Monthly Jobs]
NAME = Monitor Monthly Jobs
DESCRIPTION = Monitors monthly run segments 
TASK_TYPE = LOOP
ITERATION_LIMIT = GMI Test Workflow.Workflow Properties.Date and Time.NUM_SUBMITS

[Task.Run Yearly Jobs.Monitor Monthly Jobs.Watch Job]
NAME = Watch Monthly Job
DESCRIPTION = 
TASK_TYPE = SYSTEM
EXECUTABLE_OBJECT = $NED_WORKING_DIR/$NED_UNIQUE_ID/bin/monitor_gmi_segment.bash
TASK_DEPENDENCY = Reset Date eq Completed 

[Task.Run Yearly Jobs.Monitor Monthly Jobs.Archive Monthly Outputs Locally]
NAME = Archive Monthly Outputs Locally
DESCRIPTION = 
TASK_TYPE = SYSTEM
EXECUTABLE_OBJECT = $NED_WORKING_DIR/$NED_UNIQUE_ID/bin/archive_outputs.bash
TASK_DEPENDENCY = Watch Job eq Completed


#------------------------------------------------------------------------------
# User Utilities
#------------------------------------------------------------------------------

[Task.User Utilities]
NAME = User Utilities
DESCRIPTION = 
TASK_TYPE = PARENT

[Task.User Utilities.Clean Environment]
NAME = Clean Environment
DESCRIPTION = 
TASK_TYPE = SYSTEM
EXECUTABLE_OBJECT = sleep 2
TASK_DEPENDENCY
TASK_STATUS = SUSPENDED

[Task.User Utilities.Kill Job]
NAME = Kill Job
DESCRIPTION = 
TASK_TYPE = SYSTEM
EXECUTABLE_OBJECT = sleep 2
TASK_DEPENDENCY
TASK_STATUS = SUSPENDED

[Task.User Utilities.Transfer Outputs to GMI Archive]
NAME = Transfer Outputs to GMI Archive
DESCRIPTION = 
TASK_TYPE = SYSTEM
EXECUTABLE_OBJECT = $NED_WORKING_DIR/$NED_UNIQUE_ID/bin/transfer_output.bash
TASK_DEPENDENCY
TASK_DEPENDENCY = SUSPENDED
